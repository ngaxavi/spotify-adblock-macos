# Run spotify in a container
#
# docker run -d \
#	-v /etc/localtime:/etc/localtime:ro \
#	-v /tmp/.X11-unix:/tmp/.X11-unix \
#	-e DISPLAY=unix$DISPLAY \
#	--device /dev/snd:/dev/snd \
#	-v $HOME/.spotify/config:/home/spotify/.config/spotify \
#	-v $HOME/.spotify/cache:/home/spotify/spotify \
#	--name spotify \
#	jess/spotify


docker run -d -e DISPLAY=host.docker.internal:0 -e PULSE_SERVER=docker.for.mac.localhost -v $HOME/.spotify/config/home/spotify/.config/spotify -v $HOME/.spotify/cache/home/spotify/spotify -v ~/.config/pulse:/root/.config/pulse --env ALSA_CARD=pulse --group-add audio --name spotify -d spotify:latest
#
FROM debian:sid-slim

RUN	apt-get update && apt-get install -y \
	dirmngr \
	gnupg \
        ca-certificates \
	--no-install-recommends \
	&& apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4773BD5E130D1D45 \
	&& echo "deb http://repository.spotify.com stable non-free" >> /etc/apt/sources.list.d/spotify.list \
	&& apt-get update && apt-get install -y \
	alsa-utils \
	libgl1-mesa-dri \
	libgl1-mesa-glx \
        ffmpeg \
        xterm \
        nano \
        git \
        build-essential \
        libcurl4-openssl-dev \
        pulseaudio \
	spotify-client \
	xdg-utils \
	--no-install-recommends \
	&& rm -rf /var/lib/apt/lists/*

# make search bar text better

RUN echo "load-module module-native-protocol-tcp" >> /etc/pulse/default.pa
RUN git clone https://github.com/abba23/spotify-adblock-linux.git && cd spotify-adblock-linux && make

ENTRYPOINT	[ "xterm" ]
#CMD [ "-stylesheet=/home/spotify/spotify-override.css" ]
